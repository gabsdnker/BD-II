Nome: Gabrielli Danker e Gabriel Carvalho

Nome do banco de dados: gabi
Nome da tabela: faculdade
Colunas da tabela "faculdade": id, nome, email , cpf, curso, semestre

/*Criando a tabela "faculdade" no banco de dados "gabi"*/

CREATE TABLE gabi.faculdade (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(255),
    email VARCHAR(255),
    cpf VARCHAR(14),
    curso VARCHAR(255),
    semestre INT,
    v INT
);

/*Criando uma tabela para armazenar as versões da tabela "faculdade" com um carimbo de v1, v2, v3, etc...*/

CREATE TABLE gabi.faculdade_versions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nome VARCHAR(255),
    email VARCHAR(255),
    cpf VARCHAR(14),
    curso VARCHAR(255),
    semestre INT,
    v INT

);


/*Criando um trigger que gere automaticamente o nome da versão com o formato "v1", "v2", "v3"*/

CREATE TRIGGER faculdade_insert
BEFORE INSERT ON gabi.faculdade
FOR EACH ROW
BEGIN
	DECLARE next_version INT;
    SET next_version = (SELECT IFNULL(MAX(v), 0) + 1 FROM gabi.faculdade_versions);
    
    INSERT INTO gabi.faculdade_versions (v, id, nome, email, cpf, curso, semestre)
    VALUES (next_version,NEW.id, NEW.nome,NEW.email, NEW.cpf, NEW.curso, NEW.semestre);
END;

/*CANCELAR TRIGGER*/
DROP trigger faculdade_insert;

/*Criando a VIEW: OBS:. Não foi verificado se está certo*/ 
CREATE OR REPLACE VIEW gabi.faculdade_version_view AS
SELECT
    CONCAT('v', v.version_id) AS version_name,
    f.id,
    f.nome,
    f.email,
    f.cpf,
    f.curso,
    f.semestre,
    v.timestamp
FROM gabi.faculdade_versions v
JOIN gabi.faculdade f ON v.id = f.id;



